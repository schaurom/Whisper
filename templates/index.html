<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper Transkription</title>
    <!-- Fügen Sie Bootstrap-CSS hinzu (entweder lokal oder über ein CDN) -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>

    <div class="container mt-5">
        <h1 class="mb-4">Whisper Transkription</h1>
        <div class="input-group">
          <input type="file" class="form-control" id="inputGroupFile04" aria-describedby="inputGroupFileAddon04" aria-label="Upload" accept=".mp3, .wav" required>
          <button class="btn btn-primary mb-3" type="button" id="inputGroupFileAddon04">Upload/Transcribe</button>
        </div>
<!--        <div class="custom-file mb-3">
            <input type="file" class="custom-file-input" id="customFile" accept=".mp3, .wav" required>
            <label class="custom-file-label" for="customFile">Audiodatei auswählen</label>
        </div>
        <button type="button" class="btn btn-primary mb-3">Transkribieren und Herunterladen</button>-->

        <!-- {{ status }} -->

        {% for message in get_flashed_messages() %}
            <div class="alert alert-info">{{ message }}</div>
        {% endfor %}

        {% if error %}
            <p class="text-danger">{{ error }}</p>
        {% endif %}

        {% if warning %}
            <p class="text-warning">{{ warning }}</p>
        {% endif %}

        <!-- {% if success %} -->
            <!-- Zeigen Sie den Download-Button an, wenn eine Transkription vorhanden ist -->
            <a href="{{ url_for('download') }}" class="btn btn-success mb-3" download>Transkription Herunterladen</a>
        <!-- {% endif %} -->

    </div>

    <!-- Fügen Sie Bootstrap-JavaScript hinzu (entweder lokal oder über ein CDN) -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Fügen Sie diese Zeilen am Ende Ihres HTML-Bodys hinzu -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Warten Sie, bis die DOM vollständig geladen ist

            // Holen Sie sich den Dateieingabebereich (ID des Buttons)
            const fileInput = document.getElementById('inputGroupFile04');

            // Holen Sie sich den Button
            const transcribeButton = document.querySelector('.btn-primary');

            // Fügen Sie einen Event-Listener zum Button hinzu
            transcribeButton.addEventListener('click', function () {
                // Überprüfen Sie, ob eine Datei ausgewählt wurde
                if (fileInput.files.length > 0) {
                    // Holen Sie sich die ausgewählte Datei
                    const file = fileInput.files[0];

                    // Erstellen Sie ein FormData-Objekt
                    const formData = new FormData();

                    // Fügen Sie die Datei zum FormData-Objekt hinzu
                    formData.append('file', file);

                    // Senden Sie eine POST-Anfrage mit der ausgewählten Datei an den Server
                    fetch('/transcribe', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Zeigen Sie die Transkription oder Fehlermeldung an
                        if (data.transcription) {
                            alert('Transkription: ' + data.transcription);
                        } else if (data.error) {
                            alert('Fehler: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Fehler:', error);
                    });
                } else {
                    // Wenn keine Datei ausgewählt wurde, zeigen Sie eine Fehlermeldung an
                    alert('Bitte wählen Sie eine Datei aus.');
                }
            });
        });
    </script>

</body>

</html>

